<h1 class="page-header">New Invoice</h1>

<div class="row">
  <div class="col-md-3">
    <label>Bill To :</label>
    <p><%= @client.company_name %></p>
    <p><%= @client.company_name %></p>
    <p><%= @client.street_one %> <%= @client.street_one %></p>
  </div>
</div>

<hr />

<div class="table-responsive">
  <%= form_tag(invoices_path, method: :post) do %>
    <table id="table-data" class="table table-striped">
      <thead>
        <tr>
          <th>Demo Date</th>
          <th>Location</th>
          <th>Start Time</th>        
          <th>Rate</th>
          <th>Product Expenses</th>
          <th>Travel Expense</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <% @services.each_with_index do |service, i|  %>
          <tr>
            <td><%= service.start_at.strftime('%m/%d/%Y') %></td>
            <td><%= link_to(service.location.name, report_url(service.report)) %></td> 
            <td><%= service.start_at.strftime("%I:%M %p") %></td>        
            <td><%= number_to_currency((service.client.nil? ? "" : service.client.rate)) %></td> 
            <td><%= number_to_currency service.report.expense_one %></td>
            <td><%= service.brand_ambassador.mileage ? (service.report.travel_expense.nil? ? "-" : number_to_currency(service.report.travel_expense)) : "-" %></td>
            <td><%= number_to_currency(service.grand_total) %></td>
          </tr>
        <% end %>

        <tr style="border-top: 2px; border-top-style: dashed; border-bottom: 2px; border-bottom-style: dashed;">
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td><strong>Sub Total</strong></td>
          <td><%= number_to_currency @services.collect{|x| x.client.rate.to_f}.sum %></td>
          <td><%= number_to_currency @services.collect{|x| x.report.expense_one.to_f}.sum %></td>
          <td><%= number_to_currency @services.collect{|x| x.report.travel_expense.to_f}.sum %></td>
          <td>&nbsp;</td>
        </tr>

        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>                
          <td>&nbsp;</td>
        </tr>

        <tr id="add-item-result" style="border-top: 2px; border-top-style: double; border-bottom: 2px; border-bottom-style: double;">
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td><strong>Total</strong></td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td id="grand-total-all" data-total="<%= @services.collect{|x| x.grand_total}.sum %>">
            <%= number_to_currency @services.collect{|x| x.grand_total}.sum %>
          </td>
        </tr>

        <tr style="border-bottom: 2px; border-bottom-style: double;">
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td><strong>Balance Due</strong></td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td id="due-total-all"><%= number_to_currency @services.collect{|x| x.grand_total}.sum %></td>
        </tr>

      </tbody>
    </table>
    <%= hidden_field_tag("rate_total_all", @services.collect{|x| x.client.rate.to_f}.sum) %>
    <%= hidden_field_tag("expsense_total_all", @services.collect{|x| x.report.expense_one.to_f}.sum) %>
    <%= hidden_field_tag("travel_total_all", @services.collect{|x| x.report.travel_expense.to_f}.sum) %>
    <%= hidden_field_tag("grand_total", @services.collect{|x| x.grand_total}.sum) %>
    <%= hidden_field_tag("grand_total_all", @services.collect{|x| x.grand_total}.sum) %>
    <%= hidden_field_tag("service_ids", @service_ids.join(",")) %>    
    <%= hidden_field_tag("client_id", @client.id) %>    
    <%= submit_tag("Create Invoice", class: "btn btn-primary") %>
  <% end %>
</div>
<hr />
<div class="row">
  <div class="link-new-btn">
    <%= link_to("Insert Additional Line Item", "#", {id: "insert_add_item", class: "btn btn-primary", role: "button"}) %>
  </div>
</div>  


<div id="insert-add-item-modal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title" id="mySmallModalLabel">
          Insert Additional Line Item
        </h4>
      </div>
      <div class="modal-body">
        <label>Description : </label>
        <p><input type="text" id="insert-add-item-description"></p>
      </div>
      <div class="modal-body">
        <label>Amount : </label>
        <p><input type="text" id="insert-add-item-amount"></p>
      </div>
      <div class="modal-body">
        <button id="submit-insert-add-item-amount" class="btn btn-primary">Submit</button>
      </div>
    </div>
  </div>
</div>