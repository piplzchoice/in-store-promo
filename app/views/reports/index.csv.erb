<% if current_user.has_role?(:admin) || current_user.has_role?(:ismp) %>
  <%- headers = ["Date", "Time", "Client Name", "BA", "Demo Rate", "Expenses", "Mileage", "Status"] -%>
  <%= CSV.generate_line headers %>
  <%- @services.each do |service| -%>
    <%= CSV.generate_line([
      service.start_at.strftime('%m/%d/%Y'), 
      service.start_at.strftime("%I:%M %p"),
      (service.project.nil? ? "-" : service.company_name),
      (service.brand_ambassador.nil? ? "-" : service.brand_ambassador.name),
      (service.project.nil? ? "-" : number_to_currency(service.project.rate)),
      service.report.nil? ? "-" : number_to_currency(service.report.sum_expense),
      (service.brand_ambassador.nil? ? "-" : service.brand_ambassador.mileage),
      service.current_status
    ]) %>
  <%- end -%>
<% elsif current_user.has_role?(:client) %>
  <%- headers = ["Date", "Times", "BA", "Job Details"] -%>
  <%= CSV.generate_line headers %>
  <%- @services.each do |service| -%>
    <%= CSV.generate_line([
      service.start_at.strftime('%m/%d/%Y'), 
      service.time_at,
      (service.brand_ambassador.nil? ? "-" : service.brand_ambassador.name),
      service.details
    ]) %>
  <%- end -%>  
<% else %>
  <%- headers = ["Date", "Times", "Client Name", "Job Details"] -%>
  <%= CSV.generate_line headers %>
  <%- @services.each do |service| -%>
    <%= CSV.generate_line([
      service.start_at.strftime('%m/%d/%Y'), 
      service.time_at,
      (service.project.nil? ? "-" : service.company_name),
      service.details
    ]) %>
  <%- end -%>
<% end %>

